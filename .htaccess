# Configuración de PHP
php_value upload_max_filesize 100M
php_value post_max_size 100M
php_value max_execution_time 600
php_value max_input_time 600
php_value memory_limit 512M

<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Redirigir a HTTPS si no lo está
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    
    # Permitir acceso específico a archivos JSON en la carpeta lottie
    RewriteRule ^lottie/.*\.json$ - [L]
    
    # Permitir acceso a storage
    RewriteRule ^storage/(.*)$ public/storage/$1 [L]
    
    # Si no es un archivo o directorio existente
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>

# Permitir acceso a imágenes y archivos comunes
<FilesMatch "\.(jpg|jpeg|png|gif|webp|pdf|doc|docx|xls|xlsx)$">
    Order Allow,Deny
    Allow from all
</FilesMatch>

# Comprimir archivos
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/x-javascript text/javascript application/json
</IfModule>

# Cache control
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access 1 year"
    ExpiresByType image/jpeg "access 1 year"
    ExpiresByType image/gif "access 1 year"
    ExpiresByType image/png "access 1 year"
    ExpiresByType text/css "access 1 month"
    ExpiresByType application/javascript "access 1 month"
    ExpiresByType text/javascript "access 1 month"
    ExpiresByType application/x-javascript "access 1 month"
    ExpiresByType application/json "access 1 day"
    ExpiresByType image/x-icon "access 1 year"
    ExpiresDefault "access 2 days"
</IfModule>

# Aumentar límites de tiempo y memoria
<IfModule mod_php.c>
    php_value max_execution_time 300
    php_value max_input_time 300
    php_value memory_limit 256M
    php_value post_max_size 100M
    php_value upload_max_filesize 100M
</IfModule>

# Proteger archivos sensibles
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Proteger archivos sensibles excepto los JSON en la carpeta lottie
<FilesMatch "^(?!lottie/).*\.(env|config|json|lock|md)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Headers de seguridad
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-XSS-Protection "1; mode=block"
    Header set X-Frame-Options "SAMEORIGIN"
    
    # CORS para archivos permitidos
    <FilesMatch "\.(jpg|jpeg|png|gif|js|css|woff|woff2|ttf|eot)$">
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>

    # CORS específico para archivos JSON en la carpeta lottie
    <FilesMatch "^/?lottie/.*\.json$">
        Header set Access-Control-Allow-Origin "*"
        Header set Content-Type "application/json"
    </FilesMatch>
</IfModule>

# Prevenir listado de directorios
Options -Indexes

# Bloquear acceso a archivos específicos
<FilesMatch "(composer\.json|composer\.lock|package\.json|package-lock\.json|yarn\.lock)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protección adicional
<IfModule mod_headers.c>
    # Prevenir clickjacking
    Header always append X-Frame-Options SAMEORIGIN
    # Prevenir MIME-type sniffing
    Header always set X-Content-Type-Options nosniff
    # Habilitar la protección XSS en navegadores modernos
    Header always set X-XSS-Protection "1; mode=block"
    # Habilitar HSTS
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
</IfModule>

# php -- BEGIN cPanel-generated handler, do not edit
# Set the “ea-php81” package as the default “PHP” programming language.
<IfModule mime_module>
  AddHandler application/x-httpd-ea-php81 .php .php8 .phtml
</IfModule>
# php -- END cPanel-generated handler, do not edit
